(function O(k,j,z){function p(s,t){if(!j[s]){if(!k[s]){var o=typeof require=="function"&&require;if(!t&&o)return o(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var w=j[s]={exports:{}};k[s][0].call(w.exports,function(d){var F=k[s][1][d];return p(F||d)},w,w.exports,O,k,j,z)}return j[s].exports}for(var a=typeof require=="function"&&require,u=0;u<z.length;u++)p(z[u]);return p})({1:[function(O,k,j){var z=O("./TypedNeuQuant.js"),p=O("./LZWEncoder.js");function a(){this.page=-1,this.pages=[],this.newPage()}a.pageSize=4096,a.charMap={};for(var u=0;u<256;u++)a.charMap[u]=String.fromCharCode(u);a.prototype.newPage=function(){this.pages[++this.page]=new Uint8Array(a.pageSize),this.cursor=0},a.prototype.getData=function(){for(var t="",o=0;o<this.pages.length;o++)for(var l=0;l<a.pageSize;l++)t+=a.charMap[this.pages[o][l]];return t},a.prototype.writeByte=function(t){this.cursor>=a.pageSize&&this.newPage(),this.pages[this.page][this.cursor++]=t},a.prototype.writeUTFBytes=function(t){for(var o=t.length,l=0;l<o;l++)this.writeByte(t.charCodeAt(l))},a.prototype.writeBytes=function(t,o,l){for(var w=l||t.length,d=o||0;d<w;d++)this.writeByte(t[d])};function s(t,o){this.width=~~t,this.height=~~o,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.neuQuant=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.dither=!1,this.globalPalette=!1,this.out=new a}s.prototype.setDelay=function(t){this.delay=Math.round(t/10)},s.prototype.setFrameRate=function(t){this.delay=Math.round(100/t)},s.prototype.setDispose=function(t){t>=0&&(this.dispose=t)},s.prototype.setRepeat=function(t){this.repeat=t},s.prototype.setTransparent=function(t){this.transparent=t},s.prototype.addFrame=function(t){this.image=t,this.colorTab=this.globalPalette&&this.globalPalette.slice?this.globalPalette:null,this.getImagePixels(),this.analyzePixels(),this.globalPalette===!0&&(this.globalPalette=this.colorTab),this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),!this.firstFrame&&!this.globalPalette&&this.writePalette(),this.writePixels(),this.firstFrame=!1},s.prototype.finish=function(){this.out.writeByte(59)},s.prototype.setQuality=function(t){t<1&&(t=1),this.sample=t},s.prototype.setDither=function(t){t===!0&&(t="FloydSteinberg"),this.dither=t},s.prototype.setGlobalPalette=function(t){this.globalPalette=t},s.prototype.getGlobalPalette=function(){return this.globalPalette&&this.globalPalette.slice&&this.globalPalette.slice(0)||this.globalPalette},s.prototype.writeHeader=function(){this.out.writeUTFBytes("GIF89a")},s.prototype.analyzePixels=function(){this.colorTab||(this.neuQuant=new z(this.pixels,this.sample),this.neuQuant.buildColormap(),this.colorTab=this.neuQuant.getColormap()),this.dither?this.ditherPixels(this.dither.replace("-serpentine",""),this.dither.match(/-serpentine/)!==null):this.indexPixels(),this.pixels=null,this.colorDepth=8,this.palSize=7,this.transparent!==null&&(this.transIndex=this.findClosest(this.transparent,!0))},s.prototype.indexPixels=function(t){var o=this.pixels.length/3;this.indexedPixels=new Uint8Array(o);for(var l=0,w=0;w<o;w++){var d=this.findClosestRGB(this.pixels[l++]&255,this.pixels[l++]&255,this.pixels[l++]&255);this.usedEntry[d]=!0,this.indexedPixels[w]=d}},s.prototype.ditherPixels=function(t,o){var l={FalseFloydSteinberg:[[.375,1,0],[.375,0,1],[.25,1,1]],FloydSteinberg:[[.4375,1,0],[.1875,-1,1],[.3125,0,1],[.0625,1,1]],Stucki:[[.19047619047619047,1,0],[.09523809523809523,2,0],[.047619047619047616,-2,1],[.09523809523809523,-1,1],[.19047619047619047,0,1],[.09523809523809523,1,1],[.047619047619047616,2,1],[.023809523809523808,-2,2],[.047619047619047616,-1,2],[.09523809523809523,0,2],[.047619047619047616,1,2],[.023809523809523808,2,2]],Atkinson:[[.125,1,0],[.125,2,0],[.125,-1,1],[.125,0,1],[.125,1,1],[.125,0,2]]};if(!t||!l[t])throw"Unknown dithering kernel: "+t;var w=l[t],d=0,F=this.height,B=this.width,T=this.pixels,m=o?-1:1;this.indexedPixels=new Uint8Array(this.pixels.length/3);for(var E=0;E<F;E++){o&&(m=m*-1);for(var C=m==1?0:B-1,G=m==1?B:0;C!==G;C+=m){d=E*B+C;var y=d*3,N=T[y],Z=T[y+1],I=T[y+2];y=this.findClosestRGB(N,Z,I),this.usedEntry[y]=!0,this.indexedPixels[d]=y,y*=3;for(var W=this.colorTab[y],H=this.colorTab[y+1],K=this.colorTab[y+2],X=N-W,tt=Z-H,et=I-K,Q=m==1?0:w.length-1,q=m==1?w.length:0;Q!==q;Q+=m){var c=w[Q][1],_=w[Q][2];if(c+C>=0&&c+C<B&&_+E>=0&&_+E<F){var f=w[Q][0];y=d+c+_*B,y*=3,T[y]=Math.max(0,Math.min(255,T[y]+X*f)),T[y+1]=Math.max(0,Math.min(255,T[y+1]+tt*f)),T[y+2]=Math.max(0,Math.min(255,T[y+2]+et*f))}}}}},s.prototype.findClosest=function(t,o){return this.findClosestRGB((t&16711680)>>16,(t&65280)>>8,t&255,o)},s.prototype.findClosestRGB=function(t,o,l,w){if(this.colorTab===null)return-1;if(this.neuQuant&&!w)return this.neuQuant.lookupRGB(t,o,l);for(var d=0,F=256*256*256,B=this.colorTab.length,T=0,m=0;T<B;m++){var E=t-(this.colorTab[T++]&255),C=o-(this.colorTab[T++]&255),G=l-(this.colorTab[T++]&255),y=E*E+C*C+G*G;(!w||this.usedEntry[m])&&y<F&&(F=y,d=m)}return d},s.prototype.getImagePixels=function(){var t=this.width,o=this.height;this.pixels=new Uint8Array(t*o*3);for(var l=this.image,w=0,d=0,F=0;F<o;F++)for(var B=0;B<t;B++)this.pixels[d++]=l[w++],this.pixels[d++]=l[w++],this.pixels[d++]=l[w++],w++},s.prototype.writeGraphicCtrlExt=function(){this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4);var t,o;this.transparent===null?(t=0,o=0):(t=1,o=2),this.dispose>=0&&(o=dispose&7),o<<=2,this.out.writeByte(0|o|0|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0)},s.prototype.writeImageDesc=function(){this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame||this.globalPalette?this.out.writeByte(0):this.out.writeByte(128|this.palSize)},s.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.out.writeByte(0),this.out.writeByte(0)},s.prototype.writeNetscapeExt=function(){this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeUTFBytes("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0)},s.prototype.writePalette=function(){this.out.writeBytes(this.colorTab);for(var t=3*256-this.colorTab.length,o=0;o<t;o++)this.out.writeByte(0)},s.prototype.writeShort=function(t){this.out.writeByte(t&255),this.out.writeByte(t>>8&255)},s.prototype.writePixels=function(){var t=new p(this.width,this.height,this.indexedPixels,this.colorDepth);t.encode(this.out)},s.prototype.stream=function(){return this.out},k.exports=s},{"./LZWEncoder.js":2,"./TypedNeuQuant.js":3}],2:[function(O,k,j){var z=-1,p=12,a=5003,u=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function s(t,o,l,w){var d=Math.max(2,w),F=new Uint8Array(256),B=new Int32Array(a),T=new Int32Array(a),m,E=0,C,G=0,y,N=!1,Z,I,W;function H(f,S){F[C++]=f,C>=254&&Q(S)}function K(f){X(a),G=I+2,N=!0,_(I,f)}function X(f){for(var S=0;S<f;++S)B[S]=-1}function tt(f,S){var U,Y,D,R,it,$,J;for(Z=f,N=!1,n_bits=Z,y=q(n_bits),I=1<<f-1,W=I+1,G=I+2,C=0,R=c(),J=0,U=a;U<65536;U*=2)++J;J=8-J,$=a,X($),_(I,S);t:for(;(Y=c())!=z;){if(U=(Y<<p)+R,D=Y<<J^R,B[D]===U){R=T[D];continue}else if(B[D]>=0){it=$-D,D===0&&(it=1);do if((D-=it)<0&&(D+=$),B[D]===U){R=T[D];continue t}while(B[D]>=0)}_(R,S),R=Y,G<1<<p?(T[D]=G++,B[D]=U):K(S)}_(R,S),_(W,S)}function et(f){f.writeByte(d),remaining=t*o,curPixel=0,tt(d+1,f),f.writeByte(0)}function Q(f){C>0&&(f.writeByte(C),f.writeBytes(F,0,C),C=0)}function q(f){return(1<<f)-1}function c(){if(remaining===0)return z;--remaining;var f=l[curPixel++];return f&255}function _(f,S){for(m&=u[E],E>0?m|=f<<E:m=f,E+=n_bits;E>=8;)H(m&255,S),m>>=8,E-=8;if((G>y||N)&&(N?(y=q(n_bits=Z),N=!1):(++n_bits,n_bits==p?y=1<<p:y=q(n_bits))),f==W){for(;E>0;)H(m&255,S),m>>=8,E-=8;Q(S)}}this.encode=et}k.exports=s},{}],3:[function(O,k,j){var z=100,p=256,a=p-1,u=4,s=16,t=1<<s,o=10,l=10,w=t>>l,d=t<<o-l,F=p>>3,B=6,T=1<<B,m=F*T,E=30,C=10,G=1<<C,y=8,N=1<<y,Z=C+y,I=1<<Z,W=499,H=491,K=487,X=503,tt=3*X;function et(Q,q){var c,_,f,S,U;function Y(){c=[],_=new Int32Array(256),f=new Int32Array(p),S=new Int32Array(p),U=new Int32Array(p>>3);var i,e;for(i=0;i<p;i++)e=(i<<u+8)/p,c[i]=new Float64Array([e,e,e,0]),S[i]=t/p,f[i]=0}function D(){for(var i=0;i<p;i++)c[i][0]>>=u,c[i][1]>>=u,c[i][2]>>=u,c[i][3]=i}function R(i,e,g,r,v){c[e][0]-=i*(c[e][0]-g)/G,c[e][1]-=i*(c[e][1]-r)/G,c[e][2]-=i*(c[e][2]-v)/G}function it(i,e,g,r,v){for(var n=Math.abs(e-i),b=Math.min(e+i,p),h=e+1,x=e-1,M=1,P,A;h<b||x>n;)A=U[M++],h<b&&(P=c[h++],P[0]-=A*(P[0]-g)/I,P[1]-=A*(P[1]-r)/I,P[2]-=A*(P[2]-v)/I),x>n&&(P=c[x--],P[0]-=A*(P[0]-g)/I,P[1]-=A*(P[1]-r)/I,P[2]-=A*(P[2]-v)/I)}function $(i,e,g){var r=2147483647,v=r,n=-1,b=n,h,x,M,P,A;for(h=0;h<p;h++)x=c[h],M=Math.abs(x[0]-i)+Math.abs(x[1]-e)+Math.abs(x[2]-g),M<r&&(r=M,n=h),P=M-(f[h]>>s-u),P<v&&(v=P,b=h),A=S[h]>>l,S[h]-=A,f[h]+=A<<o;return S[n]+=w,f[n]-=d,b}function J(){var i,e,g,r,v,n,b=0,h=0;for(i=0;i<p;i++){for(g=c[i],v=i,n=g[1],e=i+1;e<p;e++)r=c[e],r[1]<n&&(v=e,n=r[1]);if(r=c[v],i!=v&&(e=r[0],r[0]=g[0],g[0]=e,e=r[1],r[1]=g[1],g[1]=e,e=r[2],r[2]=g[2],g[2]=e,e=r[3],r[3]=g[3],g[3]=e),n!=b){for(_[b]=h+i>>1,e=b+1;e<n;e++)_[e]=i;b=n,h=i}}for(_[b]=h+a>>1,e=b+1;e<256;e++)_[e]=a}function rt(i,e,g){for(var r,v,n,b=1e3,h=-1,x=_[e],M=x-1;x<p||M>=0;)x<p&&(v=c[x],n=v[1]-e,n>=b?x=p:(x++,n<0&&(n=-n),r=v[0]-i,r<0&&(r=-r),n+=r,n<b&&(r=v[2]-g,r<0&&(r=-r),n+=r,n<b&&(b=n,h=v[3])))),M>=0&&(v=c[M],n=e-v[1],n>=b?M=-1:(M--,n<0&&(n=-n),r=v[0]-i,r<0&&(r=-r),n+=r,n<b&&(r=v[2]-g,r<0&&(r=-r),n+=r,n<b&&(b=n,h=v[3]))));return h}function at(){var i,e=Q.length,g=30+(q-1)/3,r=e/(3*q),v=~~(r/z),n=G,b=m,h=b>>B;for(h<=1&&(h=0),i=0;i<h;i++)U[i]=n*((h*h-i*i)*N/(h*h));var x;e<tt?(q=1,x=3):e%W!==0?x=3*W:e%H!==0?x=3*H:e%K!==0?x=3*K:x=3*X;var M,P,A,L,V=0;for(i=0;i<r;)if(M=(Q[V]&255)<<u,P=(Q[V+1]&255)<<u,A=(Q[V+2]&255)<<u,L=$(M,P,A),R(n,L,M,P,A),h!==0&&it(h,L,M,P,A),V+=x,V>=e&&(V-=e),i++,v===0&&(v=1),i%v===0)for(n-=n/g,b-=b/E,h=b>>B,h<=1&&(h=0),L=0;L<h;L++)U[L]=n*((h*h-L*L)*N/(h*h))}function st(){Y(),at(),D(),J()}this.buildColormap=st;function nt(){for(var i=[],e=[],g=0;g<p;g++)e[c[g][3]]=g;for(var r=0,v=0;v<p;v++){var n=e[v];i[r++]=c[n][0],i[r++]=c[n][1],i[r++]=c[n][2]}return i}this.getColormap=nt,this.lookupRGB=rt}k.exports=et},{}],4:[function(O,k,j){var z,p;z=O("./GIFEncoder.js"),p=function(a){var u,s,t,o;return u=new z(a.width,a.height),a.index===0?u.writeHeader():u.firstFrame=!1,u.setTransparent(a.transparent),u.setRepeat(a.repeat),u.setDelay(a.delay),u.setQuality(a.quality),u.setDither(a.dither),u.setGlobalPalette(a.globalPalette),u.addFrame(a.data),a.last&&u.finish(),a.globalPalette===!0&&(a.globalPalette=u.getGlobalPalette()),t=u.stream(),a.data=t.pages,a.cursor=t.cursor,a.pageSize=t.constructor.pageSize,a.canTransfer?(o=function(){var l,w,d,F;for(d=a.data,F=[],l=0,w=d.length;l<w;l++)s=d[l],F.push(s.buffer);return F}(),self.postMessage(a,o)):self.postMessage(a)},self.onmessage=function(a){return p(a.data)}},{"./GIFEncoder.js":1}]},{},[4]);
